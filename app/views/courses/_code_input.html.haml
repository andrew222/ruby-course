.code_input
	= text_area :code, :text

:javascript
	
	$(document).ready(function(){
		var myCodeMirror = CodeMirror.fromTextArea(document.getElementById('code_text'), {
			mode: "text/x-ruby",
			theme: "rubyblue",
			tabMode: "indent",
			lineNumbers: true,
			matchBrackets: true,
			autofocus: true,
			indentUnit: 4
		});
		myCodeMirror.on('keypress', function(obj, event){
			if(event.keyCode == 13 ){
				window.obj = obj;
				var me = obj,
						last_line;
				$.ajax({
					type: "POST",
		      url: "/excute_code.json",
		      data: { code: me.doc.getValue() },
		      dataType: "json",
		      beforeSend: function(){
		      	last_line = obj.doc.lastLine();
		      	console.log("before send data");
		      },
		      success: function(data) {
		        me.doc.setLine(last_line, data.result.toString() + "\n")
		      },
					error: function(error){
						console.log(error);
					}
				})
			}
		})
	});